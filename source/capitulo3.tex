\chapter{Plataforma para avaliação de protocolos de encaminhamento de dados em
RSSF}\label{cap:Plataforma}

Tendo sido abordadas as temáticas relacionadas com a problemática da segurança
numa RSSF e dos aspectos que concorrem para o seu estudo, nomeadamente no que se
refere a ambientes de simulação, neste capítulo apresenta-se a proposta para
implementação da plataforma de simulação desenvolvida no âmbito deste trabalho,
que visa a avaliação de protocolos de encaminhamento de dados em RSSF. Esta
plataforma tem como principal objectivo aliar a agilização do desenho de
topologias de RSSF à integração de unidades modulares que permitam a
sistematização do processo de análise de protocolos de encaminhamento quando
sujeitos a ataques preconizados nos modelos de adversário já apresentados.
Tendo em vista o estudo do impacte destes protocolos no que se refere a
propriedades de fiabilidade, latência, cobertura da rede e consumo de energia.

\section{Desenho e concepção da plataforma de simulação}
Na concepção da plataforma de simulação, desde logo foi assumida a necessidade 
de não ser uma solução \textit{from the scratch}, a decisão passou por
estabelecer como ponto de partida um sistema de simulação já existente. Assim
sendo, e tendo sido apresentados os ambientes tidos em conta para este estudo,
as hipóteses iam desde a implementação de módulos de avaliação de segurança em
simuladores mais evoluídos, estando condicionado a um estudo aprofundado da
arquitectura de cada um, até à alteração profunda e adaptação, dos
simuladores, a ambientes de RSSF, por forma a simular o comportamento dos
sensores durante a sua operação. Perante este cenário e tendo em conta os
objectivos da plataforma que se pretende desenvolver, principalmente com o
objectivo de integrar componentes orientados para uma avaliação de propriedades
de segurança e da forma como estas afectam os  protocolos de encaminhamento a
decisão foi a utilização do simulador JProwler\cite{jprowler}. 

\subsection{Consolidação da avaliação do simulador JProwler e a sua integração}\label{sec:elab_aval_amb_sim}
Do estudo das plataformas de simulação existentes e apresentadas neste
relatório, foi seleccionado um motor de simulação com os modelos principais para
simulação de um ambiente de RSSF (comunicação, gerador de eventos discretos e
plataformas de sensores). Tendo em conta os critérios observados, para o estudo
de um simulador que servisse de base para a nova plataforma, o sistema
seleccionado foi o JProwler\cite{jprowler} . Esta escolha deveu-se
fundamentalmente ao facto deste simulador ter um comportamento muito semelhante
ao de uma rede de sensores uma vez que foi implementado na tentativa de se
aproximar o mais possível do sistema TinyOS \cite{tinyos} em particular
simulando as plataformas Mica2 \cite{mica2}.
O facto do JProwler apresentar uma estrutura minimalista e simples, facilitou o
entendimento do seu funcionamento e com isto a identificação de  cada componente
envolvido na simulação com vista à sua reutilização/extensão para a incorporação
das diversas funcionalidades que se planearam  implementar na plataforma. Uma
das vantagens da simplicidade do simulador recaí sobre a necessidade que existe
de interceptar determinados eventos que ocorrem durante a simulação por forma a
permitir a sua medição. Um exemplo é a necessidade de interceptar o envio e a
recepção de mensagens com o intuito de medir os consumos energéticos destas
operações.

\subsubsection[Arquitectura do simulador JProwler]{Arquitectura do simulador
JProwler} 
\input{pic_sim_jprowler_cd}
O simulador base, JProwler\cite{jprowler}, é composto por um conjunto de nove
 classes que são representadas no diagrama \ref{fig:jprowler_cd}. Este simulador
está estruturado em três grupos de funções: a) Motor de simulação, que
representando o ambiente de operação de uma RSSF, caracterizado pelo gerador de
eventos discretos e modelos de rádio (Simulator, Event, RadioModel); b)
Plataformas de execução, que simulam o comportamento dos nós sensores (Node,
Mica2Node, Application); c) Visualização, permitindo observar a topologia da
rede. 

Para utilizar este simulador para o estudo de um protocolo de encaminhamento,
tal como existe actualmente, é necessário implementar uma classe derivada de
Application com a lógica do protocolo. A implementação de uma plataforma sensor,
disponibilizada no JProwler\cite{jprowler}, é monolítica ou seja não observa uma
divisão por camadas, como a apresentada em \cite{VER_CITACAO DA PILHA}. É certo
que nas plataformas físicas observa-se uma forte afinidade entre as camadas do
sensor, uma vez que algumas vezes ao nível aplicação é necessário ter acesso a
dados da camada MAC ou transporte, de modo a facilitar o controlo do estado da
aplicação, por exemplo, para a implementação de alguma forma de fiabilidade por
retransmissão. No entanto, é de relevante interesse dotar o simulador de uma
visão mais estratificada e ainda possibilitando a exposição das funcionalidades
intra-camadas. Respeitando uma interface básica em cada uma das camadas é
possível permutar diferentes implementações de cada uma das camadas  por forma 
a testar diversas configurações dos sensores.

Este simulador não incorpora algumas das funcionalidades que se consideram 
interessantes de observar, de forma genérica, quando se pretende avaliar um
protocolo de encaminhamento seguro em RSSF. Um exemplo é a capacidade de ter uma
visão do consumo de energia da rede durante uma simulação e poder observar o seu
impacte durante a operação e quando esta rede está sujeita a um qualquer
ataque dos já estudados. 

\subsubsection[Funcionamento do simulador JProwler]{Funcionamento do simulador
JProwler} 
Como já foi referido o simulador procura ir ao encontro do funcionamento dos 
\textit  {motes} Mica2\cite{mica2_datasheet}  e com o sistema de eventos
implementado pelo TinyOS\cite{tinyos}. Neste sistema em cada momento apenas está
a ser tratada uma mensagem de cada vez, o que faz com que,  caso cheguem várias
mensagens ao mesmo tempo, algumas mensagens se possam perder. O modelo de rádio
preconiza um mecanismo de \textit{backoff} em caso de falha na transmissão. A
introdução de ruído na transmissão é materializada com base numa distribuição de
Gauss, este ruído permite aproximar do comportamento de uma rede real. A
existência de uma pilha de eventos que executa um conjunto de eventos em cada
iteração permite simular a ocorrência de diversos eventos em diferentes pontos
da rede, ao mesmo tempo. Considerando, no entanto, que a noção de tempo é
intrínseca ao simulador, e que assim sendo um conjunto de eventos ocorre ao
mesmo tempo, em tempo de simulação. 

A interface gráfica disponibilizada, apenas permite a visualização dos nós 
sensores e a obtenção de alguma informação referente ao estado da transmissão,
materializada por um código de cores, a possibilidade de dispor um determinado
nó sensor de forma orientada com recurso a um sistema \textit{drag-and-drop} não
se encontra disponível. A distribuição dos nós na área de trabalho é realizado
de forma aleatória, permitindo obter uma rede com alguma homogeneidade no que
respeita à distribuição dos sensores pela área. A implementação dos sensores,
não preconiza a existência de diversos estados de operação dos sensores, ou
seja, à semelhança do que se observa ao nível da gestão de energia de um sensor
durante o seu ciclo de vida, com os estados, por exemplo, activo, inactivo e
adormecido. Estes estados são, normalmente, geridos ao nível MAC dependendo dos
protocolos que cada sensor implementa\cite{SMAC, BMAC}.

\subsection{Proposta para a arquitectura da plataforma de simulação}
\label{sec:apresent_arch}

Para melhor percepção da arquitectura da plataforma de simulação, esta é 
apresentada sob a  forma de uma pilha de serviços. Como se
pode ver na \figurename{ \ref{fig:sim_arch}}, os principais serviços são: 
i) Simulador base ou motor de simulação; ii) Camada de Instrumentação e Teste;
iii) API para a implementação e avaliação de protocolos de encaminhamento; iv)
Consola de visualização e controlo de simulação.
\input{pic_sim_arch}
\subsubsection[Simulador base ou motor de simulação]{Simulador base ou motor de
simulação}
Como já foi referido o motor de simulação resulta da extensão do simulador 
JProwler. De uma forma geral, o simulador já implementa os modelos base de um
RSSF, nomeadamente no que respeita ao modelo de acesso ao meio e no modelo
rádio. A tarefa principal aqui foi dissecar a forma de funcionamento por forma a
expor algumas das parametrizações, tornando-as acessíveis a partir da consola de
operação ou dos ficheiros de configuração. Ainda relacionado com o motor de
simulação determinou-se que a melhor forma de estruturar um nó sensor era seguir
um modelo de camadas, o que levou à separação de cada um dos componentes que se
encontravam consolidados numa única classe  monolítica representativa de um nó
sensor. Esta visão permite a separação de conceitos, sendo consideradas apenas
três camadas: i) Camada MAC; ii) Camada de Encaminhamento; iii) Camada de
Aplicação. Na figura \ref{fig:stack_components} é possível observar esta
organização. De forma tornar o nó sensor ainda mais modular procurou-se mapear
os componentes de um sensor num conjunto de classes, tal como é apresentada na
figura \ref{fig:stack_components}.
\input{pic_nodestackcomponents} 
No que se refere à noção de nó sensor também se pretende que este tenha um 
desenho bastante semelhante à arquitectura real. Para tal, o nó sensor é
modelado por componentes equivalentes à realidade fisíca. Isto é, existe um
componente \textit{CPU}, um componente \textit{Transciever} e um componente
\textit{Batery}. Este desenho permite que os dois primeiros componentes
interajam entre si e em particular com o terceiro para cálculo do consumo
energético. Assim, cada componente tem associado um conjunto de acções que são
da sua responsabilidade em que  cada uma consome um determinado valor energético
(definido por parametrização do modelo de energia). Desta forma é permitido
implementar especializações de cada componente tendo em vista observações
especificas de determinada experiência.

\subsubsection[Camada de instrumentação]{Camada de instrumentação}
Esta camada contém um conjunto de ferramentas que controlam a simulação 
nomeadamente no que respeita aos mecanismos principais que se pretendeu
implementar na plataforma: 
\paragraph[]{Mecanismo de Configuração}\label{sec:impl_conf}
Para dotar a plataforma de maior flexibilidade, a existência de um componente
 gestor de configurações revela-se importante. Este componente deve ser
transversal a toda 
plataforma. Para que as parametrizações possam ser persistentes e portáveis, 
adoptar-se-á a tecnologia XML para a definição dos ficheiros de configuração da
plataforma. As principais funcionalidades que se prevêem existir vão desde as
configurações dos parâmetros do simulador base, até à configuração de cada uma
das simulações que se pretendem estudar, como forma de possibilitar a repetição
de experiências nas mesmas condições.
\paragraph[]{Mecanismo de Geração de Topologias}\label{sec:impl_topo}
As RSSF, normalmente, são caracterizadas por diferentes formas de distribuição
dos nós sensores. Estas distribuições podem ser essencialmente divididas em dois modelos:
aleatório e estruturado. Assim, para que se consiga observar as
características que se pretendem analisar num protocolo de encaminhamento, é
fornecido um componente cuja função é gerar topologias na rede. Sabe-se que, de facto, a
topologia da rede pode influenciar o comportamento de um protocolo. Pretende-se que este
componente possibilite a extensão para novas topologias (específicas para determinada
simulação).
\paragraph[]{Mecanismos de medição de propriedades da rede}\label{sec:impl_energia}
Por forma a permitir a avaliação de protocolos de encaminhamento foi necessário
 proceder-se ao desenvolvimento de ferramentas de medição de propriedades que se
pretendia observar em cada um dos protocolos. A energia, a cobertura da rede, a
latência das comunicações e a fiabilidade da rede são as propriedades principais
que necessitaram de ver implementados componentes específicos para avaliação em
cada simulação ou experiência.
\subparagraph[]{Módulo de Energia}
Este é um dos componentes de maior importância, uma vez que um dos
indicadores que se pretende observar na análise de protocolos de encaminhamento 
é o impacte sobre o tempo útil de operação da rede, quer em condições de
funcionamento normais, quer  em condições de ataque efectivo, tempo este que
está dependente da energia. 
A energia é um recurso escasso numa RSSF. Para a implementação de mecanismos de 
segurança, é necessário recorrer a maior computação, transmissão de dados de
forma segura e capacidade de verificação de determinadas propriedades de
segurança. Sendo reconhecida a importância desta ferramenta os princípios
orientadores para a sua implementação foram: i) Tornar a expressividade destes
consumos na lógica dos protocolos o mais transparente possível; ii) Adoptar um
modelo o mais próximo possível da realidade, principalmente no que refere aos
consumos de cada operação de um nó sensor; iii) Parametrização do modelo de
energia por forma a permitir a calibração o mais próxima do valores reais; iv)
Capacidade para analisar em pós processamento os dados resultantes da análise de
consumo energético, para a elaboração de gráficos representativos dos resultados
obtidos; v) Capacidade de, em tempo real, prever os perfis de consumo de modo a
evitar a execução de longas simulações sem que os resultados obtidos se revelem
desnecessários para o estudo em causa.

\subparagraph[]{Módulo de Cobertura/Fiabilidade/Latência da Rede}
Mediante as tipologias de ataques estudadas, observa-se que, um dos resultados 
destes ataques é a possibilidade de criar partições numa rede, limitar as
comunicações de modo selectivo ou alterar de modo total ou parcial a informação
de encaminhamento resultando, em qualquer um dos casos, na perda de dados.
Assim, interessa desde logo observar a capacidade de resistência de um protocolo
quando sujeito a determinados ataques e aferir com isto qual o nível de
disponibilidade da rede durante estas fases. Não obstante este facto, a rede
deverá sempre ser medida no seu funcionamento normal e não sujeito a ataques.
Com este módulo, é possível medir as propriedades de cobertura, fiabilidade e
latência da rede segundo seguintes as definições:
\begin{itemize}
\item[Cobertura:] É entendida como a capacidade de um qualquer sensor da rede
conseguir comunicar com um qualquer outro nó da rede utilizando o protocolo de
encaminhamento de dados implementado. A análise resultante da observação desta
capacidade pode ser comparada com a cobertura estabelecida pela comunicação
rádio. Interessa portanto realçar que apesar de todos os sensores de uma rede
estarem cobertos em certa medida por comunicação rádio, isso não é condição
suficiente para para garantir a transmissão de dados de um qualquer ponto A
para um qualquer ponto B, uma vez que podem existir partições na rede.

\item[Fiabilidade:] É entendida como a medida que avalia a qualidade da
comunicação face ao modo de transmissão, modo este que compreende toda a camada
de software utilizada na arquitectura de um sensor. Assim, o resultado da
análise desta medida indica o índice de qualidade de informação  que um
qualquer sensor pode enviar para outro. É medida tendo em conta o numero de
mensagens enviadas face às mensagens recebidas entre quais quer dois sensores
de uma rede, tipicamente um sensor gerador de eventos e uma estação base.
alguns parâmetros podem ainda afectar os resultados observados, como por
exemplo o número de retransmissões de cada mensagem e o intervalo de tempo
entre o envio de cada mensagem.

\item[Latência:] Uma vez que se trata de uma rede a latência é uma métrica
sempre a ter presente numa análise. Esta medida poderia ser efectuada de duas
formas: a) por tempo decorrido entre dois pontos; b) por numero de nós pelos
quais passa uma mensagem. A primeira acaba por ser difícil de medir uma vez que
se trata de um sistema simulado em que o factor tempo nem sempre tem a
resolução que nos permita aferir com rigor a qualidade desta medida. No segundo
caso o número de \textit{hops} percorridos por uma mensagem acaba por ser uma
medida bastante genérica e precisa que nos permite aferir da qualidade da
comunicação entre dois quaisquer pontos, podendo-se depois deste modo
extrapolar um valor estimado para o tempo decorrido em função de uma qualquer
largura de banda.
\end{itemize}

\paragraph[]{Mecanismo de Injecção de Falhas / Ataques ao Encaminhamento
}\label{sec:impl_ataques}
Sendo o tema central deste trabalho o estudo de protocolos de encaminhamento
seguro em RSSF, este componente é da maior importância nesta plataforma, por
diferentes ordens de razões:
i) Não existe nenhum sistema de simulação que permita a indução de ataques de
forma simples e intuitiva, consubstanciado-se, por isso, num contributo para a
inovação; ii) Deverá ser suficientemente flexível para se adaptar à lógica de
cada algoritmo; iii) Poderá permitir a mutação de código em
tempo de execução da simulação, por forma a alterar comportamentos do protocolo;
iv) Idealmente deverá permitir acrescentar mais modelos de ataques, dos já
tipificados neste relatório ou de outros
que venham a ser identificados.

Com o mecanismo de injecção de ataques procurou-se tornar o mais intuitiva
possível a sua utilização, assumindo desde logo que um ataque a um sensor
implica a alteração/supressão do conteúdo de uma mensagem. Assim, é possível
neste modelo activar o modo de ataque em cada um dos sensores bem como
seleccionar o ataque que se pretende observar, podendo coexistir com diversos
outros ataques implementados, limitando a operação de apenas um de cada vez em
cada sensor. É possível medir o impacte do ataque pelo número de mensagens que
atravessam os nós atacantes.

\paragraph{Execução de testes e recolha de resultados}
A avaliação de um protocolo de encaminhamento, preconiza a repetição de
baterias de testes e a variação de alguns parâmetros como base
de comparação de resultados e por forma a se poder observar tendências e
comportamentos da rede. O modelo de execução testes e recolha de resultados
seguiu modelo definido que permite sistematizar a sua utilização face a
diversas composições de RSSF. 
Este componente do simulador reveste-se de enorme importância uma vez que
permite agilizar todo o estudo e concentrar nestas experiências o foco da
avaliação de um protocolo de encaminhamento de dados. Assim sendo,
compreende-se como experiência, uma simulação com as seguintes propriedades:

\begin{enumerate}
\item Topologia bem definida (aleatória, em grelha ou estruturada);
\item Protocolo de encaminhamento;
\item Modelo de Energia parametrizado;
\item Bateria de testes;
\item Ataques ao nível do encaminhamento;
\end{enumerate}

Estas propriedades permitem sistematizar a avaliação de um qualquer protocolo
de encaminhamento de dados seguro/ou não, vejamos: Para avaliar quaisquer
protocolos é possível cruzar estas propriedades de diversas formas e comparar os
resultados com uma abordagem metódica. O que se observa em alguns
simuladores é que a forma de implementação dos testes é diferente em cada
protocolo o que pode levar a diferenças que influenciem os resultados. Com a
definição destes critérios e da metodologia genérica de avaliação de protocolos
é possível na realidade ter a mesma base de comparação para protocolos
diferentes, permitindo afinar as conclusões no que concerne ao seu comportamento
em termos de segurança e no impacte nas propriedades que se pretende observar.

Foi implementada uma função para influenciar o sinal de transmissão com o 
decréscimo da energia na bateria. Outra das variáveis interessantes de observar
é a do meio de ambiente que em função de algumas características, por exemplo
da humidade do ar, influenciam o comportamento da comunicação rádio
\cite{HUMiDADE_RADIO}. A parametrização do factor da altura do sensor face ao
solo também é tida em conta para a topologia da rede.

\subsubsection{Consola de Visualização e Controlo de Simulação}\label{sec:impl_visual}
Existe a necessidade de dotar a plataforma de uma consola de operação, que
permita interagir com o simulador de forma intuitiva e fácil. Como tal, é
necessário implementar um componente para visualização gráfica de toda
a simulação, bem como o controlo de parâmetros de execução e configuração.
Neste sentido, foi desenvolvido um ambiente gráfico integrado, que permite a
configuração da plataforma, a configuração e visualização das simulações e a
extracção de resultados relacionados com as medidas que se pretendem avaliar,
também sob a forma de gráficos.
\subsubsection{API para implementação de protocolos de encaminhamento}
Uma vez que o ponto de partida da plataforma é uma simulador que respeita uma
API, com a integração de novas funcionalidades com características de 
avaliação em diferentes camadas do \textit{software} das plataformas
sensoriais, surge um conjunto de interfaces que garantem a inter-operação entre
os protocolos e o simulador facilitando a medição das propriedades já indicadas.
No capítulo seguinte é possível observar alguns destes interfaces que tornam a
utilização de algumas funcionalidades o mais transparente possível por forma a
permitir o mesmo tipo de acções de avaliação que contribuem para uma melhor
sistematização da análise entre diversas implementações de protocolos.
%\subsubsection{Avaliação da Solução}\label{sec:aval_solucao}
%Uma vez que a contribuição efectiva para a componente de investigação de
%protocolos de encaminhamento seguros em RSSF será obtida com a concepção de uma
%plataforma de
%simulação que suporte o estudo e a análise desta problemática, importa
%sujeitá-la a uma avaliação
%primária que permita comprovar a sua utilidade e/ou identificar eventuais
%lacunas neste domínio.
%Assim, tendo esta avaliação em vista, pretende-se contribuir com o estudo dos
%protocolos de
%encaminhamento seguro Clean-Slate e INSENS. Para isso, definem-se duas fases
%complementares na
%elaboração da tese: uma que visa a implementação de um protocolo simples, que
%permita aferir o
%correcto funcionamento da plataforma, e outra que vise a implementação dos dois
%protocolos referidos,
%que serão alvo de uma análise comparativa com recurso às funcionalidades da
%plataforma. 

