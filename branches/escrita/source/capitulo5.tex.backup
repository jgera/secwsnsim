\chapter[Prova de Conceito da Plataforma]{Prova de Conceito da Plataforma}

Uma vez implementada a plataforma de simulação é necessário submete-la a uma
utilização dirigida para o fim para o qual foi concebida. Tendo isto em
atenção, este capítulo apresenta a implementação de dois protocolos de
encaminhamento de dados em RSSF. O primeiro trata-se de um protocolo simplista,
encaminhamento por \textit{inundação }, que visa, fundamentalmente, demonstrar a
facilidade de implementação de um primeiro protocolo e ao mesmo tempo servir de
termo de comparação com um protocolo seguro. O segundo protocolo, é um
protocolo de encaminhamento seguro de referência, o INSENS\cite{INSENS}.
Esta implementação, visa, não só provar que é possível implementar, avaliar e
experimentar protocolos de especificação mais complexa, mas também contribuir
com uma análise critica deste protocolo em critérios de segurança e no seu
impacte nas propriedades que se podem avaliar com recurso à plataforma de
simulação.

Com a implementação destes dois protocolos, este capítulo, inicialmente,
descreve uma metodologia para a implementação de protocolos de encaminhamento
usando a API concebida. 

\section{Metodologia para a implementação de um protocolo}

A implementação de um qualquer protocolo pode ser divida em duas componentes:
1) a componente lógica, associada ao funcionamento do protocolo; 
2) a componente de integração, associada à integração/interacção com a
plataforma.

\subsection{Componente Lógica}
Para esta componente é necessário identificar as entidades principais de
especificação do protocolo. Entidades estas que serão comuns a qualquer
protocolo que se pretenda implementar:

\begin{enumerate}
 \item Message: Entidade que representa a unidade mínima de envio/recepção de
dados. Contém uma estrutura genérica para gestão da informação manipulada,
de forma transparente, pelo simulador juntamente com a representação da
informação transportada, sob a forma de vector de bytes, assemelhando-se com o
formato real de um pacote de comunicação;
\item Node: Esta entidade tem, fundamentalmente, funções associadas a
visualização (ex: raio, cores associadas ao estado) e podendo ter também
informação transversal a todas as camadas para facilidade de acesso e que
necessita de inicialização prévia (ex. desligado/ligado), a quando da construção
do nó. Poderá não ser implementado se estas condições não se verificarem
utilizando-se assim um Node genérico disponibilizado pela API.
\item RoutingLayer: Esta é a entidade principal, uma vez que que
contém a lógica do protocolo e que deverá respeitar algumas especificações da
API para que a sua integração com o simulador seja adequada;
\item Application: Representa a camada aplicacional que será suportada em
termos de encaminhamento pelo protocolo implementado. Pode ser usado para
testar comportamentos da mesma aplicação com protocolos de
encaminhamento diferentes.
\end{enumerate}

Na figura seguinte observa-se a estrutura de implementação do protocolo de
inundação seguindo a implementação referida. 
\input{pic_protocol_struct} 

\subsection{Componente de integração}
Nesta componente é necessário criar uma entidade que integra/define
quais as camadas existentes num sensor genérico de um protocolo. Esta entidade é
definida usando um padrão de \textit{factory}. Padrão este, que é consumido
pela plataforma para criação de sensores a quando da sua distribuição na área
de trabalho. Esta entidade durante a criação dos nós será ainda complementada
com informação referente a parâmetros do modelo de energia.
Na figura seguinte pode-se observar a simplicidade desta entidade e a forma de
integração.
\input{pic_node_factory} 
Quanto à integração com a plataforma, é necessário, ao nível do RoutingLayer,
respeitar as especificações definidas pela API do simulador. Salienta-se de
seguida as que se julgam essenciais:


%\input{tab_API_routing}

\section{Implementação de protocolo de encaminhamento por inundação}
Como já foi referido para efeito de comparação de algumas das propriedades em
avaliação foi desenvolvido um primeiro protocolo mais simples que implementa o
encaminhamento por inundação (\textit{flooding}). Este protocolo não tem grande
complexidade de funcionamento, uma vez que a única restrição para a propagação
de mensagens é a garantia de não repetição de mensagens. 

A implementação define no total cinco classes, respeitando as duas componentes
referidas anteriormente. As entidades representadas são: Um tipo de mensagem,
uma fábrica de nós, um nó específico e o algoritmo de encaminhamento, para
efeitos de teste foi criada uma aplicação simples que envia uma mensagem de
Hello. No diagrama de classes da figura seguinte apresenta-se esta organização.

APRESENTAR DIAGRAMA AQUI

A implementação do protocolo tem o seguinte funcionamento:

\section{Implementação de Protocolo de Encaminhamento Seguro em RSSF}
O algoritmo que serviu como prova de conceito para a utilização da plataforma
na avaliação de protocolos de encaminhamento seguro foi o INSENS. O
desenvolvimento deste protocolo permitiu rever algumas funcionalidades da
plataforma, desenvolvidas até então, fazendo com que se desse a
incorporação de mecanismos facilitadores quer ao nível da implementação, quer
ao nível das capacidades de avaliação da plataforma. Uma abstracção
que surgiu da implementação deste protocolo foram os \textit{timers}, muito
semelhante aos implementados nas plataformas de TinyOS, que permitem temporizar
acções, com base num relógio interno. Uma vez identificada esta funcionalidade,
foi integrada no simulador base por forma a poder ser utilizada de forma
genérica na implementação de um qualquer protocolo.\\

O código executado nas plataformas sensores é muito semelhante e somente
diferenciado pelos papeis que podem ser desempenhados por um sensor. Neste
protocolo identificaram-se dois tipos de papeis: 1) estação base, que controla
todo o fluxo da informação e que serve como \textit{Trusted Computer Base} uma
vez que é o único elemento que se garante que é totalmente seguro; 2) Sensor
genérico, encaminhador e gerador de eventos. Uma vez tratando-se de uma
plataforma de simulação a selecção dos sensores que executam as tarefas de cada
um dos papeis identificados é especificada pelo próprio desenho da
experiência. No que respeita às operações executadas pela estação base
apresentam-se a seguir as que têm maior importância ao longo do estabelecimento
da rede:

\input{tab_operacoes_sensores}

Apresentadas as operações principais da estação base, os restantes sensores
executam também um conjunto de operações das quais se destinguem as seguintes:
\input{tab_operacoes_sensores_normais}

Do ponto de vista da implementação foram respeitadas as API's da plataforma
para permitir a sua integração. Assim, a figura seguinte apresenta o diagrama de
classes da implementação do protocolo INSENS.
